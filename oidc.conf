<IfModule !cgi_module>
    LoadModule cgi_module modules/mod_cgi.so
</IfModule>
<IfModule !auth_openidc_module>
    LoadModule auth_openidc_module /usr/lib/apache2/mod_auth_openidc.so
</IfModule>

<VirtualHost *:443>
    SSLEngine on
    SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire
    SSLCertificateFile /etc/ssl/certs/server.crt
    SSLCertificateKeyFile /etc/ssl/private/server.key
</VirtualHost>

<VirtualHost *:80>
    Redirect permanent / https://localhost/
</VirtualHost>

<IfModule auth_openidc_module>
    LogLevel debug
    OIDCRedirectURI https://localhost/callback
    OIDCProviderMetadataURL http://localhost:8081/auth/realms/master/.well-known/openid-configuration
    OIDCClientID  client_id
    OIDCClientSecret client_secret
    OIDCSSLValidateServer Off
    OIDCCryptoPassphrase secret    
    <Location />
        AuthType openid-connect
        Require valid-user
    </Location>
    <Location /cgi-bin/env.cgi>
        AuthType openid-connect
        OIDCUnAuthAction pass
    </location>
</IfModule>
